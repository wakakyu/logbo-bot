# 私を読んで
Misskey Login Bonus Bot for msky.haibala.com

## サンプル
`msky.haibala.com` で動作している子

https://msky.haibala.com/@loginbonus

## 概要

本プログラムは、Misskeyサーバー上で動作するログインボーナス管理ボットです。
めいすきーのログインボーナスbotのオマージュになります。
ユーザーのログインボーナスの取得状況を管理し、
連続ログイン日数および通算ログイン日数を記録します。
また、機械的な自動投稿に対する対策機能や、ランキング表示機能を備えています。

## 主な機能

1. ログインボーナス管理
    1. ユーザーが「ログボ」「ログインボーナス」などを含むノートを投稿すると、その日のログインを記録します。
    2. 連続ログイン日数と通算ログイン日数を計算し、返信を行います。
    3. 日付の更新は日本時間の午前5時に行われます。
    4. 既にその日のログボを取得済みの場合は、その旨を通知します。
1. ランキング機能
    1. 「ランキング」を含むノートを投稿すると、連続ログイン日数および通算ログイン日数の上位10名を表示します。
1. 自動化対策（暫定）
    1. 投稿時刻の秒数が「00秒」である場合、自動投稿ツールによるアクセスとみなし、認証を要求します。
    1. ログボボットが指定した6桁の認証コードを含めて返信することで、ログインボーナスが受理されます。
1. フォロワー限定機能
    <!-- 1. ボットをフォローしているユーザーのみが機能を利用できます。-->
    1. 未フォローの場合はフォローを促すメッセージを返信します。
    1. 「follow me」または「フォローして」と投稿することで、ボットからフォローバックを行います。
1. 動作要件
    1. Node.js (推奨バージョン: v18以上)
    1. SQLite3 (データ保存用)
    1. Misskeyアカウントおよびアクセストークン

## セットアップ手順
### リポジトリのクローン
ソースコードをローカル環境に保存します。

<!-- ### 依存関係のインストール
以下のコマンドを実行し、必要なライブラリをインストールしてください。
```
npm install
```
-->

### 環境変数の設定
プロジェクトのルートディレクトリに .env ファイルを作成するか、Dockerの環境変数として以下の値を設定してください。
- `MISSKEY_URL`:MisskeyサーバーのURL (例: https://msky.haibala.com)
- `MISSKEY_TOKEN`:ボットアカウントのAPIトークン

### 起動
Docker Composeを使用する場合は以下を実行してください。
```
docker-compose up -d --build
```

## 使用方法
### ログインボーナスの受け取り
ボットが見える範囲（メンション、タイムライン等）で以下のキーワードを含むノートを投稿してください。
- ログボ
- ろぐぼ

### 自動化対策について
投稿時刻が xx分00秒 ジャストの場合、認証コードの入力を求められます。
ボットからの返信に記載された数字（例: 123456）を含めて、再度返信を行ってください。

### ランキングの確認
以下のいずれかのキーワードを含むノートを投稿してください。
- ランキング
- らんきんぐ

### フォローバックの依頼
以下のキーワードを含むノートを投稿してください。
- follow me
- フォローして

## ディレクトリ構成とデータ保存
初回起動時に自動的に ./data ディレクトリが作成され、その中にSQLiteデータベースファイル (database.db) が生成されます。 
Dockerを使用する場合、このディレクトリをボリュームとして永続化することを推奨します。

## 注意事項
1. 本ボットは、Misskey独自のMFMやカスタム絵文字を使用しています。接続先のサーバーで絵文字が利用できない場合、表示が崩れる可能性があります。
1. 連続ログイン日数は、前回のログボ取得から日付（午前5時区切り）が連続している場合のみ加算されます。
